<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>æŠ½å¥–åå°</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC",Arial;
  background:#f6f7fb;
}
.container{
  max-width:420px;
  margin:auto;
  padding:16px;
}
h2{text-align:center;}
.card{
  background:#fff;
  border-radius:12px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 6px 18px rgba(0,0,0,.06);
}
label{display:block;margin-top:12px;font-weight:bold;}
input{
  width:100%;
  height:36px;
  margin-top:6px;
  padding:0 10px;
  font-size:16px;
}
button{
  width:100%;
  height:44px;
  margin-top:16px;
  font-size:16px;
  font-weight:bold;
  border:none;
  border-radius:22px;
  background:linear-gradient(135deg,#ff512f,#dd2476);
  color:#fff;
}
button:active{transform:scale(.96);}
table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}
th,td{
  border-bottom:1px solid #eee;
  padding:8px 4px;
  text-align:left;
}
.hidden{display:none;}
</style>
</head>

<body>

<div class="container">

  <!-- ç™»å½• -->
  <div id="login" class="card">
    <h2>ğŸ” åå°ç™»å½•</h2>
    <input id="password" type="password" placeholder="è¯·è¾“å…¥åå°å¯†ç " />
    <button onclick="login()">è¿›å…¥åå°</button>
  </div>

  <!-- åå° -->
  <div id="panel" class="hidden">

    <div class="card">
      <h2>âš™ æŠ½å¥–é…ç½®</h2>

      <label>å‰©ä½™æŠ½å¥–æ¬¡æ•°</label>
      <input id="chances" type="number" min="0" />

      <div id="prizeConfig"></div>

      <button onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
    </div>

    <div class="card">
      <h2>ğŸ“Š æŠ½å¥–è®°å½•</h2>
      <table>
        <thead>
          <tr><th>æ—¶é—´</th><th>å¥–é¡¹</th></tr>
        </thead>
        <tbody id="history"></tbody>
      </table>
    </div>

  </div>

</div>

<script>
/* ====== å¯è‡ªè¡Œä¿®æ”¹çš„åå°å¯†ç  ====== */
const ADMIN_PASSWORD = "123456";

/* ====== ç™»å½• ====== */
function login(){
  const pwd = document.getElementById("password").value;
  if(pwd !== ADMIN_PASSWORD){
    alert("å¯†ç é”™è¯¯");
    return;
  }
  document.getElementById("login").style.display="none";
  document.getElementById("panel").classList.remove("hidden");
  loadStatus();
}

/* ====== åŠ è½½çŠ¶æ€ ====== */
async function loadStatus(){
  const res = await fetch("/api/status");
  const data = await res.json();

  document.getElementById("chances").value = data.chances;

  // å¥–é¡¹æ¦‚ç‡
  const box = document.getElementById("prizeConfig");
  box.innerHTML = "";
  data.prizes.forEach((p,i)=>{
    box.innerHTML += `
      <label>${p.name} æ¦‚ç‡æƒé‡</label>
      <input type="number" min="0" data-index="${i}" value="${p.weight}">
    `;
  });

  // è®°å½•
  document.getElementById("history").innerHTML =
    data.history.map(h=>`
      <tr>
        <td>${h.time}</td>
        <td>${h.prize}</td>
      </tr>
    `).join("");
}

/* ====== ä¿å­˜é…ç½® ====== */
async function saveConfig(){
  const chances = Number(document.getElementById("chances").value);
  const inputs = document.querySelectorAll("#prizeConfig input");

  const prizes = [...inputs].map(i=>({
    weight:Number(i.value)
  }));

  const res = await fetch("/api/config",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ chances, prizes })
  });

  const data = await res.json();
  if(data.ok){
    alert("ä¿å­˜æˆåŠŸ");
    loadStatus();
  }else{
    alert("ä¿å­˜å¤±è´¥");
  }
}
</script>

</body>
</html>
