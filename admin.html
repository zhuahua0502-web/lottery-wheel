<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æŠ½å¥–åå°</title>
<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC",Arial;
  background:#f7f7f7;
  padding:20px;
}
.box{
  max-width:420px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}
h2{text-align:center}
.row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:10px 0;
}
input{
  width:80px;
  padding:6px;
}
button{
  width:100%;
  margin-top:16px;
  height:44px;
  border:none;
  border-radius:22px;
  background:#ff4d4f;
  color:#fff;
  font-size:16px;
}
.hidden{display:none}
</style>
</head>

<body>

<div class="box" id="loginBox">
  <h2>ğŸ” åå°ç™»å½•</h2>
  <input id="pwd" type="password" placeholder="åå°å¯†ç " style="width:100%;padding:10px">
  <button onclick="login()">è¿›å…¥åå°</button>
</div>

<div class="box hidden" id="adminBox">
  <h2>ğŸ› æŠ½å¥–é…ç½®</h2>

  <div class="row">
    <span>å‰©ä½™æŠ½å¥–æ¬¡æ•°</span>
    <input id="chances" type="number">
  </div>

  <h3>ğŸ å¥–é¡¹æ¦‚ç‡</h3>
  <div id="prizeList"></div>

  <button onclick="save()">ğŸ’¾ ä¿å­˜é…ç½®</button>
</div>

<script>
const PASSWORD = "123456"; // â† æ”¹æˆä½ è‡ªå·±çš„åå°å¯†ç 

let config = null;

function login(){
  if(document.getElementById("pwd").value !== PASSWORD){
    alert("å¯†ç é”™è¯¯");
    return;
  }
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("adminBox").classList.remove("hidden");
  loadConfig();
}

async function loadConfig(){
  const res = await fetch("/api/config");
  config = await res.json();

  document.getElementById("chances").value = config.chances;

  const list = document.getElementById("prizeList");
  list.innerHTML = "";

  config.prizes.forEach((p,i)=>{
    const div = document.createElement("div");
    div.className = "row";
    div.innerHTML = `
      <span>${p.name}</span>
      <input type="number" value="${p.weight}" onchange="config.prizes[${i}].weight=this.value">
    `;
    list.appendChild(div);
  });
}

async function save(){
  config.chances = Number(document.getElementById("chances").value);

  await fetch("/api/config",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(config)
  });

  alert("ä¿å­˜æˆåŠŸ");
}
</script>

</body>
</html>
