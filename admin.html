<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>æŠ½å¥–åå°ç®¡ç†</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", Arial;
  background: linear-gradient(180deg, #ffecd2, #fcb69f);
}

.login, .panel {
  max-width: 420px;
  margin: 60px auto;
  background: #fff;
  padding: 24px;
  border-radius: 16px;
  box-shadow: 0 12px 30px rgba(0,0,0,.15);
}

h2 {
  text-align: center;
  margin-bottom: 16px;
}

input {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #ddd;
}

button {
  width: 100%;
  padding: 12px;
  font-size: 18px;
  border-radius: 24px;
  border: none;
  color: #fff;
  background: linear-gradient(135deg,#ff512f,#dd2476);
  cursor: pointer;
}

.item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 10px 0;
}

.item span {
  flex: 1;
}

.item input {
  width: 100px;
}
</style>
</head>

<body>

<!-- ç™»å½• -->
<div class="login" id="loginBox">
  <h2>ğŸ” åå°ç®¡ç†ç™»å½•</h2>
  <input type="password" id="pwd" placeholder="è¯·è¾“å…¥åå°å¯†ç ">
  <button onclick="login()">ç™»å½•</button>
</div>

<!-- ç®¡ç†é¢æ¿ -->
<div class="panel" id="panel" style="display:none;">
  <h2>ğŸ› æŠ½å¥–é…ç½®</h2>

  <label>ğŸ« æ¯äººæŠ½å¥–æ¬¡æ•°</label>
  <input type="number" id="chances" min="0">

  <h3>ğŸ å¥–é¡¹æ¦‚ç‡ï¼ˆæƒé‡ï¼‰</h3>
  <div id="prizes"></div>

  <button onclick="save()">ğŸ’¾ ä¿å­˜é…ç½®</button>
</div>

<script>
/* ========= å¯è‡ªè¡Œä¿®æ”¹çš„åå°å¯†ç  ========= */
const ADMIN_PASSWORD = "littlepei2025";

/* ========= ç™»å½• ========= */
function login(){
  const v = document.getElementById("pwd").value;
  if(v !== ADMIN_PASSWORD){
    alert("å¯†ç é”™è¯¯");
    return;
  }
  document.getElementById("loginBox").style.display = "none";
  document.getElementById("panel").style.display = "block";
  load();
}

/* ========= åŠ è½½é…ç½® ========= */
async function load(){
  const res = await fetch("/api/status");
  const data = await res.json();

  document.getElementById("chances").value = data.chances;

  const prizesBox = document.getElementById("prizes");
  prizesBox.innerHTML = "";

  data.prizes.forEach((p, i)=>{
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <span>${p.name}</span>
      <input type="number" min="0" value="${p.weight}" id="w${i}">
    `;
    prizesBox.appendChild(div);
  });
}

/* ========= ä¿å­˜é…ç½® ========= */
async function save(){
  const chance = Number(document.getElementById("chances").value);

  const res0 = await fetch("/api/status");
  const cur = await res0.json();

  const prizes = cur.prizes.map((p,i)=>({
    name: p.name,
    weight: Number(document.getElementById("w"+i).value)
  }));

  const res = await fetch("/api/config",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      chances: chance,
      prizes
    })
  });

  const r = await res.json();
  if(r.ok){
    alert("âœ… ä¿å­˜æˆåŠŸ");
  }else{
    alert("âŒ ä¿å­˜å¤±è´¥");
  }
}
</script>

</body>
</html>
