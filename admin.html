<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æŠ½å¥–åå°</title>
<style>
body { font-family: Arial; padding: 20px; }
input { width: 80px; }
button { padding: 6px 12px; margin-top: 10px; }
</style>
</head>
<body>

<h2>ğŸ› æŠ½å¥–åå°ç®¡ç†</h2>

<h3>æŠ½å¥–æ¬¡æ•°</h3>
<input id="chances" type="number" min="0" />

<h3>å¥–é¡¹æ¦‚ç‡</h3>
<table id="table"></table>

<button onclick="save()">ğŸ’¾ ä¿å­˜é…ç½®</button>

<script>
async function load() {
  const res = await fetch("/api/config");
  const data = await res.json();

  document.getElementById("chances").value = data.chances;

  const table = document.getElementById("table");
  table.innerHTML = "";
  data.prizes.forEach((p, i) => {
    table.innerHTML += `
      <tr>
        <td>${p.name}</td>
        <td><input type="number" value="${p.weight}" data-i="${i}"></td>
      </tr>
    `;
  });
}

async function save() {
  const inputs = document.querySelectorAll("input[data-i]");
  const prizes = [...inputs].map(i => ({
    name: i.parentNode.previousSibling.innerText,
    weight: Number(i.value)
  }));

  await fetch("/api/config", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chances: document.getElementById("chances").value,
      prizes
    })
  });

  alert("é…ç½®å·²ä¿å­˜");
}

load();
</script>

</body>
</html>
